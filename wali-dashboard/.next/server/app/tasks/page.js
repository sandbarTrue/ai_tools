(()=>{var e={};e.id=289,e.ids=[289],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9997:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>o,routeModule:()=>m,tree:()=>c}),s(259),s(9454),s(5866);var r=s(3191),a=s(8716),l=s(7922),n=s.n(l),d=s(5231),i={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>d[e]);s.d(t,i);let c=["",{children:["tasks",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,259)),"/data00/home/zhoujun.sandbar/workspace/wali-dashboard/src/app/tasks/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9454)),"/data00/home/zhoujun.sandbar/workspace/wali-dashboard/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/data00/home/zhoujun.sandbar/workspace/wali-dashboard/src/app/tasks/page.tsx"],x="/tasks/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/tasks/page",pathname:"/tasks",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},9041:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},4354:(e,t,s)=>{Promise.resolve().then(s.bind(s,998))},2297:(e,t,s)=>{Promise.resolve().then(s.bind(s,5918))},5918:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var r=s(326),a=s(7577);function l(e){return!e||e<=0?"—":e<6e4?`${Math.round(e/1e3)}s`:`${Math.floor(e/6e4)}m${Math.round(e%6e4/1e3)}s`}function n(e){return e?e>=1?`$${e.toFixed(2)}`:`$${e.toFixed(4)}`:"$0"}function d(e){switch(e){case"active":return{text:"进行中",color:"text-green-400",bg:"bg-green-500/15 border-green-500/30"};case"done":case"verified":case"notified":return{text:"已完成",color:"text-[#8b949e]",bg:"bg-[#21262d] border-[#30363d]"};case"blocked":return{text:"阻塞",color:"text-red-400",bg:"bg-red-500/15 border-red-500/30"};case"paused":return{text:"暂停",color:"text-yellow-400",bg:"bg-yellow-500/15 border-yellow-500/30"};case"cancelled":return{text:"已终止",color:"text-red-400",bg:"bg-red-500/15 border-red-500/30"};case"proposed":return{text:"提案中",color:"text-cyan-400",bg:"bg-cyan-500/15 border-cyan-500/30"};case"pending_approval":return{text:"待审批",color:"text-orange-400",bg:"bg-orange-500/15 border-orange-500/30"};case"verifying":return{text:"验收中",color:"text-blue-400",bg:"bg-blue-500/15 border-blue-500/30"};case"verify_failed":return{text:"验收失败",color:"text-red-400",bg:"bg-red-500/15 border-red-500/30"};default:return{text:e,color:"text-[#8b949e]",bg:"bg-[#21262d] border-[#30363d]"}}}function i({steps:e}){if(!e||0===e.length)return null;let t=e.filter(e=>"completed"===e.state).length;return(0,r.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,r.jsxs)("div",{className:"text-[10px] text-[#6e7681] uppercase tracking-wider",children:["步骤 ",t,"/",e.length]}),e.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-2 text-[11px] pl-2",children:[r.jsx("span",{children:function(e){switch(e){case"completed":return"✅";case"running":return"⏳";case"failed":return"❌";default:return"⏸️"}}(e.state)}),r.jsx("span",{className:"completed"===e.state?"text-[#8b949e]":"text-white",children:e.name}),e.files&&e.files.length>0&&(0,r.jsxs)("span",{className:"text-[#484f58] truncate",title:e.files.join(", "),children:["[",e.files[0],e.files.length>1?` +${e.files.length-1}`:"","]"]})]},t))]})}function c({exec:e,defaultOpen:t=!1}){let[s,d]=(0,a.useState)(t),c=function(e){switch(e){case"success":case"completed":case"done":case"verified":return{dot:"bg-green-400",label:"成功",badge:"bg-green-500/15 text-green-400 border-green-500/30",icon:"✅"};case"failed":return{dot:"bg-red-400",label:"失败",badge:"bg-red-500/15 text-red-400 border-red-500/30",icon:"❌"};case"running":return{dot:"bg-yellow-400 animate-pulse",label:"运行中",badge:"bg-yellow-500/15 text-yellow-400 border-yellow-500/30",icon:"⏳"};default:return{dot:"bg-gray-400",label:"待执行",badge:"bg-[#21262d] text-[#8b949e] border-[#30363d]",icon:"⏸️"}}}(e.status),o=e.steps&&e.steps.length>0;return(0,r.jsxs)("details",{open:t,className:"group",children:[(0,r.jsxs)("summary",{onClick:e=>{e.preventDefault(),d(!s)},className:"flex items-center gap-3 px-3 py-2.5 cursor-pointer hover:bg-[#161b22] transition-colors list-none [&::-webkit-details-marker]:hidden",children:[r.jsx("span",{className:"text-lg",title:e.executor,children:e.executor_icon}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-xs text-white font-medium truncate",children:e.name}),(0,r.jsxs)("div",{className:"text-[10px] text-[#6e7681] mt-0.5 flex items-center gap-2 flex-wrap",children:[e.model&&r.jsx("span",{className:"text-purple-400",children:e.model}),e.duration_ms&&(0,r.jsxs)("span",{children:["\xb7 ",l(e.duration_ms)]}),e.cost_usd&&e.cost_usd>0&&(0,r.jsxs)("span",{className:"text-cyan-400",children:["\xb7 ",n(e.cost_usd)]}),e.retry_of&&r.jsx("span",{className:"text-orange-400",title:`重试自 ${e.retry_of}`,children:"\uD83D\uDD04 重试"})]})]}),e.verify_result&&(0,r.jsxs)("span",{className:`text-[10px] px-1.5 py-0.5 rounded border ${e.verify_result.passed===e.verify_result.total?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}`,children:["验收: ",e.verify_result.passed,"/",e.verify_result.total," ",e.verify_result.passed===e.verify_result.total?"✅":"❌"]}),r.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded border shrink-0 ${c.badge}`,children:c.label}),o&&r.jsx("span",{className:"text-[#484f58] text-xs group-open:rotate-180 transition-transform",children:"▼"})]}),o&&r.jsx("div",{className:"px-3 pb-3 pt-1 bg-[#0d1117] border-t border-[#21262d]",children:r.jsx(i,{steps:e.steps})}),"failed"===e.status&&e.error&&(0,r.jsxs)("div",{className:"px-3 pb-3 pt-1 bg-red-500/5 border-t border-red-500/20",children:[r.jsx("div",{className:"text-[10px] text-red-400 font-medium mb-1",children:"错误信息"}),r.jsx("p",{className:"text-[11px] text-red-400",children:e.error})]})]})}function o({task:e,isSelected:t,onClick:s}){let a=d(e.status),l=e.executionDetails||[],n=l.length,i=l.filter(e=>"success"===e.status).length,c=l.reduce((e,t)=>e+(t.steps?.length||0),0),o=l.reduce((e,t)=>e+(t.steps?.filter(e=>"completed"===e.state)?.length||0),0);return(0,r.jsxs)("div",{onClick:s,className:`p-3 rounded-lg border cursor-pointer transition-all ${t?"bg-[#161b22] border-purple-500/50 ring-1 ring-purple-500/20":"bg-[#0d1117] border-[#21262d] hover:border-[#30363d]"}`,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:`text-sm font-medium ${"done"===e.status||"notified"===e.status?"text-[#8b949e]":"text-white"}`,children:e.title}),r.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded border ${a.bg} ${a.color}`,children:a.text})]}),e.goal&&r.jsx("p",{className:"text-[11px] text-[#6e7681] mt-1 line-clamp-1",children:e.goal}),(0,r.jsxs)("div",{className:"flex items-center gap-3 mt-2 text-[10px] text-[#484f58]",children:[e.source&&(0,r.jsxs)("span",{children:["\uD83D\uDCCE ",e.source]}),n>0&&(0,r.jsxs)("span",{className:i===n?"text-green-400":i<n&&i>0?"text-yellow-400":"",children:["⚡ ",n," 次执行 (",i," 成功 / ",n-i," 失败)"]}),c>0&&(0,r.jsxs)("span",{children:["\uD83D\uDCCB ",o,"/",c," 步骤"]})]})]})}function x({task:e}){let t=e.executionDetails||[],s=!!e.proposal,a=t.length>0,l=a&&t.every(e=>"success"===e.status),n=[{key:"proposal",label:"提案",icon:"\uD83D\uDCDD",done:s},{key:"execution",label:"执行",icon:"\uD83D\uDD27",done:l,inProgress:a&&!l},{key:"review",label:"验收",icon:"✅",done:"done"===e.status||"notified"===e.status||"verified"===e.status}],d=(e,t)=>e?{bg:"bg-green-500",border:"border-green-500",text:"text-green-400"}:t?{bg:"bg-yellow-500",border:"border-yellow-500",text:"text-yellow-400"}:{bg:"bg-gray-600",border:"border-gray-600",text:"text-gray-500"};return r.jsx("div",{className:"flex items-center justify-between py-3",children:n.map((e,t)=>{let s=d(e.done,e.inProgress||!1);return(0,r.jsxs)("div",{className:"flex items-center flex-1",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[r.jsx("div",{className:`w-8 h-8 rounded-full ${s.bg} flex items-center justify-center text-white text-sm`,children:e.icon}),r.jsx("span",{className:`text-xs mt-1 ${s.text}`,children:e.label})]}),t<n.length-1&&r.jsx("div",{className:`flex-1 h-0.5 mx-2 ${e.done?"bg-green-500":"bg-gray-700"}`})]},e.key)})})}function u({proposal:e}){let[t,s]=(0,a.useState)(!1),l=e.split("\n"),n=l.slice(0,2).join("\n"),d=l.length>2||e.length>100;return(0,r.jsxs)("div",{className:"bg-[#161b22] rounded-lg border border-cyan-500/20 overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-3 py-2 border-b border-[#21262d] flex items-center justify-between",children:[r.jsx("span",{className:"text-xs text-cyan-400 font-medium",children:"\uD83D\uDCC4 提案摘要"}),d&&r.jsx("button",{onClick:()=>s(!t),className:"text-[10px] text-purple-400 hover:text-purple-300 transition-colors",children:t?"收起 ▲":"展开 ▼"})]}),r.jsx("div",{className:"p-3",children:r.jsx("pre",{className:"text-[11px] text-[#8b949e] whitespace-pre-wrap font-sans leading-relaxed",children:t?e:n})})]})}function m(){return(0,r.jsxs)("div",{className:"bg-[#0d1117] rounded-lg border border-[#21262d] p-3 mt-4",children:[r.jsx("div",{className:"text-xs text-[#8b949e] font-medium mb-2",children:"\uD83D\uDD00 分派优先级"}),(0,r.jsxs)("div",{className:"space-y-1 text-[11px]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-green-400 font-mono",children:"1."}),r.jsx("span",{className:"text-white",children:"Claude Code + GLM-5"}),r.jsx("span",{className:"text-[#6e7681]",children:"(编码)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-yellow-400 font-mono",children:"2."}),r.jsx("span",{className:"text-white",children:"GLM-5 子agent"}),r.jsx("span",{className:"text-[#6e7681]",children:"(文本)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-orange-400 font-mono",children:"3."}),r.jsx("span",{className:"text-white",children:"MiniMax-M2.5 子agent"}),r.jsx("span",{className:"text-[#6e7681]",children:"(备选)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-red-400 font-mono",children:"4."}),r.jsx("span",{className:"text-white",children:"Opus 4.6"}),r.jsx("span",{className:"text-[#6e7681]",children:"(兜底，需报备)"})]})]})]})}function p(){let[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0),[p,h]=(0,a.useState)(null),b=e?.wali_status,g=b?.tasks||null,f=g?.tasks||[],j=f.find(e=>e.id===p)||f.find(e=>"active"===e.status)||f[0],v=j?.executionDetails||[],N=v.length,y=v.filter(e=>"success"===e.status).length,w=v.reduce((e,t)=>e+(t.cost_usd||0),0),D=v.reduce((e,t)=>e+(t.duration_ms||0),0),k=f.filter(e=>"cancelled"===e.status).length;return s&&!e?r.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"w-8 h-8 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),r.jsx("p",{className:"text-[#8b949e] text-sm",children:"加载中..."})]})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-white",children:"\uD83D\uDCCB 任务看板"}),r.jsx("p",{className:"text-sm text-[#8b949e] mt-1",children:g?`${g.active||0} 个进行中 \xb7 ${g.completed||0} 个已完成${k>0?` \xb7 ${k} 个已终止`:""} \xb7 共 ${g.total||f.length} 个任务`:"加载中..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-4 space-y-2",children:[r.jsx("div",{className:"text-xs text-[#8b949e] uppercase tracking-wider mb-3 font-medium",children:"业务任务 (L1)"}),f.map(e=>r.jsx(o,{task:e,isSelected:j?.id===e.id,onClick:()=>h(e.id)},e.id)),0===f.length&&r.jsx("div",{className:"text-center py-8 text-[#6e7681] text-sm",children:"暂无任务"})]}),r.jsx("div",{className:"lg:col-span-8",children:j?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-[#0d1117] rounded-xl border border-[#30363d] p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h2",{className:"text-lg font-semibold text-white",children:j.title}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded border ${d(j.status).bg} ${d(j.status).color}`,children:d(j.status).text})]}),j.goal&&r.jsx("p",{className:"text-sm text-[#8b949e] mb-3",children:j.goal}),(0,r.jsxs)("div",{className:"bg-[#161b22] rounded-lg p-3 mb-3",children:[r.jsx("div",{className:"text-[10px] text-[#6e7681] uppercase tracking-wider mb-2",children:"工作流"}),r.jsx(x,{task:j})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,r.jsxs)("div",{className:"bg-[#161b22] rounded-lg p-2 text-center",children:[r.jsx("div",{className:"text-lg font-bold text-white",children:N}),r.jsx("div",{className:"text-[10px] text-[#6e7681]",children:"执行次数"})]}),(0,r.jsxs)("div",{className:"bg-[#161b22] rounded-lg p-2 text-center",children:[r.jsx("div",{className:"text-lg font-bold text-green-400",children:y}),r.jsx("div",{className:"text-[10px] text-[#6e7681]",children:"成功"})]}),(0,r.jsxs)("div",{className:"bg-[#161b22] rounded-lg p-2 text-center",children:[r.jsx("div",{className:"text-lg font-bold text-purple-400",children:n(w)}),r.jsx("div",{className:"text-[10px] text-[#6e7681]",children:"总费用"})]}),(0,r.jsxs)("div",{className:"bg-[#161b22] rounded-lg p-2 text-center",children:[r.jsx("div",{className:"text-lg font-bold text-cyan-400",children:l(D)}),r.jsx("div",{className:"text-[10px] text-[#6e7681]",children:"总耗时"})]})]})]}),j.proposal&&r.jsx(u,{proposal:j.proposal}),(0,r.jsxs)("div",{className:"bg-[#0d1117] rounded-xl border border-[#30363d] overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-4 py-3 border-b border-[#21262d] flex items-center gap-2",children:[r.jsx("span",{children:"⚡"}),r.jsx("span",{className:"font-semibold text-white text-sm",children:"执行记录 (L2)"}),(0,r.jsxs)("span",{className:"text-xs text-[#6e7681]",children:["(",v.length,")"]})]}),r.jsx("div",{className:"divide-y divide-[#21262d]",children:v.length>0?v.map((e,t)=>r.jsx(c,{exec:e,defaultOpen:0===t},e.id)):r.jsx("div",{className:"px-4 py-8 text-center text-[#6e7681] text-sm",children:"暂无执行记录"})})]})]}):r.jsx("div",{className:"flex items-center justify-center h-64 text-[#6e7681] text-sm",children:"← 选择一个任务查看详情"})})]}),r.jsx(m,{})]})}},998:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var r=s(326),a=s(434),l=s(5047),n=s(7577);let d=[{href:"/",label:"总览",icon:"\uD83D\uDCCA"},{href:"/tasks",label:"任务看板",icon:"\uD83D\uDCCB"},{href:"/verify",label:"验收报告",icon:"\uD83D\uDCC4"},{href:"/models",label:"模型监控",icon:"\uD83E\uDDE0"},{href:"/skills",label:"Skills",icon:"\uD83E\uDDE9"},{href:"/crons",label:"Cron任务",icon:"⏰"},{href:"/subscriptions",label:"订阅服务",icon:"\uD83D\uDCB3"}];function i(){let e=(0,l.usePathname)(),[t,s]=(0,n.useState)(!1),[i,c]=(0,n.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:()=>c(!i),className:"fixed top-4 left-4 z-50 md:hidden bg-[#21262d] border border-[#30363d] rounded-lg p-2 text-xl",children:i?"✕":"☰"}),i&&r.jsx("div",{className:"fixed inset-0 bg-black/50 z-30 md:hidden",onClick:()=>c(!1)}),(0,r.jsxs)("aside",{className:`
          fixed top-0 left-0 h-full z-40 bg-[#161b22] border-r border-[#30363d]
          flex flex-col transition-all duration-300 ease-in-out
          ${t?"w-16":"w-60"}
          ${i?"translate-x-0":"-translate-x-full"}
          md:translate-x-0 md:relative
        `,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 h-16 border-b border-[#30363d] shrink-0",children:[!t&&(0,r.jsxs)(a.default,{href:"/",className:"flex items-center gap-2 text-lg font-bold text-white whitespace-nowrap",children:[r.jsx("span",{className:"text-2xl",children:"\uD83E\uDD16"}),r.jsx("span",{children:"瓦力控制台"})]}),t&&r.jsx(a.default,{href:"/",className:"text-2xl mx-auto",children:"\uD83E\uDD16"}),r.jsx("button",{onClick:()=>s(!t),className:"hidden md:block text-[#8b949e] hover:text-white text-sm ml-2",title:t?"展开":"收起",children:t?"→":"←"})]}),r.jsx("nav",{className:"flex-1 py-4 overflow-y-auto",children:d.map(s=>{let l=e===s.href;return(0,r.jsxs)(a.default,{href:s.href,onClick:()=>c(!1),className:`
                  flex items-center gap-3 mx-2 px-3 py-2.5 rounded-lg text-sm font-medium
                  transition-colors duration-150
                  ${l?"bg-[#21262d] text-white border border-[#30363d]":"text-[#8b949e] hover:text-white hover:bg-[#21262d]"}
                  ${t?"justify-center":""}
                `,children:[r.jsx("span",{className:"text-lg",children:s.icon}),!t&&r.jsx("span",{children:s.label})]},s.href)})}),(0,r.jsxs)("div",{className:"px-4 py-3 border-t border-[#30363d] text-xs text-[#6e7681] shrink-0",children:[!t&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 status-dot-pulse"}),r.jsx("span",{children:"系统运行中"})]}),t&&r.jsx("div",{className:"flex justify-center",children:r.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 status-dot-pulse"})})]})]})]})}},9454:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>l});var r=s(9510);s(5023);let a=(0,s(8570).createProxy)(String.raw`/data00/home/zhoujun.sandbar/workspace/wali-dashboard/src/components/Sidebar.tsx#default`),l={title:"瓦力控制台 - 搞钱看板",description:"AI Agent 运营监控仪表盘"};function n({children:e}){return r.jsx("html",{lang:"zh-CN",children:(0,r.jsxs)("body",{className:"flex min-h-screen",children:[r.jsx(a,{}),r.jsx("main",{className:"flex-1 min-h-screen overflow-auto md:ml-0",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-16 md:pt-8",children:e})})]})})}},259:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/data00/home/zhoujun.sandbar/workspace/wali-dashboard/src/app/tasks/page.tsx#default`)},5023:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,982],()=>s(9997));module.exports=r})();